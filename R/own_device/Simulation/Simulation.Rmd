---
title: "Simulation Test Thesis"
output: html_document
date: "2023-10-27"
---

---
title: "Simulation Test"
output: html_document
date: "2023-10-25"
---
# Init
```{r setup}
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```
## Setup
### Libraries
```{r, message=FALSE, warning=FALSE}
library(ggplot2)
library(caTools)
library(plotly)
library(MASS)
library(matlib)
library(dplyr)
library(pROC)
library(parallel)
library(CalibrationCurves)
source("R/Functions.R")
```


# 5 variables, covariance
### Initialize variables
```{r}
# Set random seed for reproducibility
set.seed(28)
p      <- 1                             # proportion of correlated predictors
npred  <- 5                             # number of predictors
z      <- 0.2                           # z 
n      <- 200000                       # Number of samples in the dataset
a_values_5predictors_covariance <- read.csv("data/simulation/a_values/5predictors_covariance.csv")

mu0 <- c(rep(1,npred))  
sigma0 <- scenario()

data_experiment <- mvrnorm(n, mu = mu0, Sigma = sigma0) %>%
  as.data.frame()
colnames(data_experiment) <- c(paste0("predictor", 1:(ncol(data_experiment))))
```
## 1 end predictor: normal
AUC = 0.6
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.6[1]
L <-  calculate_linear_predictor5(a, data_experiment, "normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/covar/AUC_0.6_1normal.rds")
```

AUC = 0.75
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.75[1]
L <-  calculate_linear_predictor5(a, data_experiment, "normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/covar/AUC_0.75_1normal.rds")
```

AUC = 0.9
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.9[1]
L <-  calculate_linear_predictor5(a, data_experiment, "normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/covar/AUC_0.9_1normal.rds")
```

## 1 end predictor: interaction
AUC = 0.6
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.6[2]
L <-  calculate_linear_predictor5(a, data_experiment, "interaction")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/covar/AUC_0.6_1interaction.rds")
```

AUC = 0.75
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.75[2]
L <-  calculate_linear_predictor5(a, data_experiment, "interaction")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/covar/AUC_0.75_1interaction.rds")
```

AUC = 0.9
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.9[2]
L <-  calculate_linear_predictor5(a, data_experiment, "interaction")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/covar/AUC_0.9_1interaction.rds")
```




## 2 end predictor: normal + normal
AUC = 0.6
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.6[3]
L <-  calculate_linear_predictor5(a, data_experiment, "2 normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/covar/AUC_0.6_2normal.rds")
```

AUC = 0.75
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.75[3]
L <-  calculate_linear_predictor5(a, data_experiment, "2 normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/covar/AUC_0.75_2normal.rds")
```

AUC = 0.9
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.9[3]
L <-  calculate_linear_predictor5(a, data_experiment, "2 normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/covar/AUC_0.9_2normal.rds")
```


## 2 end predictor: normal + interaction
AUC = 0.6
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.6[4]
L <-  calculate_linear_predictor5(a, data_experiment, "1 interaction & 1 normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/covar/AUC_0.6_2normalinteraction.rds")
```

AUC = 0.75
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.75[4]
L <-  calculate_linear_predictor5(a, data_experiment, "1 interaction & 1 normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/covar/AUC_0.75_2normalinteraction.rds")
```

AUC = 0.9
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.9[4]
L <-  calculate_linear_predictor5(a, data_experiment, "1 interaction & 1 normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/covar/AUC_0.9_2normalinteraction.rds")
```

## 2 end predictor: interaction + interaction
AUC = 0.6
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.6[5]
L <-  calculate_linear_predictor5(a, data_experiment, "2 interaction")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/covar/AUC_0.6_2interaction.rds")
```

AUC = 0.75
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.75[5]
L <-  calculate_linear_predictor5(a, data_experiment, "2 interaction")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/covar/AUC_0.75_2interaction.rds")
```

AUC = 0.9
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.9[5]
L <-  calculate_linear_predictor5(a, data_experiment, "2 interaction")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/covar/AUC_0.9_2interaction.rds")
```






# 5 variables, no covariance
### Initialize variables
```{r}
# Set random seed for reproducibility
set.seed(28)
p      <- 1                             # proportion of correlated predictors
npred  <- 5                             # number of predictors
z      <- 0                             # z 
n      <- 200000                        # Number of samples in the dataset
a_values_5predictors_covariance <- read.csv("data/simulation/a_values/5predictors_uncorrelated.csv")

mu0 <- c(rep(1,npred))  
sigma0 <- scenario()

data_experiment <- mvrnorm(n, mu = mu0, Sigma = sigma0) %>%
  as.data.frame()
colnames(data_experiment) <- c(paste0("predictor", 1:(ncol(data_experiment))))
```
## 1 end predictor: normal
AUC = 0.6
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.6[1]
L <-  calculate_linear_predictor5(a, data_experiment, "normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/uncor/AUC_0.6_1normal.rds")
```

AUC = 0.75
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.75[1]
L <-  calculate_linear_predictor5(a, data_experiment, "normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/uncor/AUC_0.75_1normal.rds")
```

AUC = 0.9
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.9[1]
L <-  calculate_linear_predictor5(a, data_experiment, "normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/uncor/AUC_0.9_1normal.rds")
```

## 1 end predictor: interaction
AUC = 0.6
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.6[2]
L <-  calculate_linear_predictor5(a, data_experiment, "interaction")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/uncor/AUC_0.6_1interaction.rds")
```

AUC = 0.75
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.75[2]
L <-  calculate_linear_predictor5(a, data_experiment, "interaction")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/uncor/AUC_0.75_1interaction.rds")
```

AUC = 0.9
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.9[2]
L <-  calculate_linear_predictor5(a, data_experiment, "interaction")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/uncor/AUC_0.9_1interaction.rds")
```




## 2 end predictor: normal + normal
AUC = 0.6
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.6[3]
L <-  calculate_linear_predictor5(a, data_experiment, "2 normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/uncor/AUC_0.6_2normal.rds")
```

AUC = 0.75
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.75[3]
L <-  calculate_linear_predictor5(a, data_experiment, "2 normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/uncor/AUC_0.75_2normal.rds")
```

AUC = 0.9
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.9[3]
L <-  calculate_linear_predictor5(a, data_experiment, "2 normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/uncor/AUC_0.9_2normal.rds")
```


## 2 end predictor: normal + interaction
AUC = 0.6
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.6[4]
L <-  calculate_linear_predictor5(a, data_experiment, "1 interaction & 1 normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/uncor/AUC_0.6_2normalinteraction.rds")
```

AUC = 0.75
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.75[4]
L <-  calculate_linear_predictor5(a, data_experiment, "1 interaction & 1 normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/uncor/AUC_0.75_2normalinteraction.rds")
```

AUC = 0.9
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.9[4]
L <-  calculate_linear_predictor5(a, data_experiment, "1 interaction & 1 normal")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/uncor/AUC_0.9_2normalinteraction.rds")
```

## 2 end predictor: interaction + interaction
AUC = 0.6
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.6[5]
L <-  calculate_linear_predictor5(a, data_experiment, "2 interaction")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/uncor/AUC_0.6_2interaction.rds")
```

AUC = 0.75
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.75[5]
L <-  calculate_linear_predictor5(a, data_experiment, "2 interaction")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/uncor/AUC_0.75_2interaction.rds")
```

AUC = 0.9
```{r, cache=T}
# Simulate binary y to have Prob(y=1) = 1/[1+exp(-L)]
a <- a_values_5predictors_covariance$AUC_0.9[5]
L <-  calculate_linear_predictor5(a, data_experiment, "2 interaction")
L <- - mean(L) + L
y <- ifelse(runif(n) < plogis(L), 1, 0)
data_experiment_temp <- cbind(data_experiment, y)

saveRDS(data_experiment_temp, "data/simulation/datasets/5pred/uncor/AUC_0.9_2interaction.rds")
```


